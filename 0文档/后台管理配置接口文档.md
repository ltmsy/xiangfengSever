# åå°ç®¡ç†é…ç½®æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†åå°ç®¡ç†ç³»ç»Ÿçš„é…ç½®ç®¡ç†ç›¸å…³æ¥å£ï¼Œæ”¯æŒæŒ‰åˆ†ç±»ç®¡ç†å„ç§ç³»ç»Ÿé…ç½®ï¼Œä¸ºå‰ç«¯æä¾›tabåˆ‡æ¢å¼çš„é…ç½®ç®¡ç†ç•Œé¢ã€‚

## ğŸ” æƒé™è¦æ±‚

- æ‰€æœ‰ç®¡ç†æ¥å£éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™
- å…¬å¼€é…ç½®æ¥å£æ— éœ€æƒé™éªŒè¯
- ä½¿ç”¨JWT Bearer Tokenè®¤è¯

## ğŸŒ åŸºç¡€ä¿¡æ¯

- **åŸºç¡€URL**: `/v1/manager`
- **è®¤è¯æ–¹å¼**: Bearer Token
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

## ğŸ“š é…ç½®åˆ†ç±»

ç³»ç»Ÿé¢„å®šä¹‰äº†ä»¥ä¸‹3ä¸ªé…ç½®åˆ†ç±»ï¼š

| åˆ†ç±»é”® | åˆ†ç±»åç§° | è¯´æ˜ |
|--------|----------|------|
| `group` | ç¾¤ç»„é…ç½® | ç¾¤ç»„ç›¸å…³åŠŸèƒ½é…ç½® |
| `system` | ç³»ç»Ÿé…ç½® | ç³»ç»ŸåŸºç¡€é…ç½® |
| `security` | å®‰å…¨é…ç½® | å®‰å…¨ç›¸å…³é…ç½® |



## ğŸ”Œ APIæ¥å£è¯¦æƒ…

### 1. è·å–é…ç½®åˆ†ç±»åˆ—è¡¨

**æ¥å£åœ°å€**: `GET /config/categories`

**æ¥å£æè¿°**: è·å–æ‰€æœ‰é…ç½®åˆ†ç±»ä¿¡æ¯ï¼Œç”¨äºå‰ç«¯tabåˆ‡æ¢

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "category": "group",
      "category_name": "ç¾¤ç»„é…ç½®",
      "count": 8
    },
    {
      "category": "system",
      "category_name": "ç³»ç»Ÿé…ç½®",
      "count": 8
    }
  ]
}
```

**å“åº”å­—æ®µè¯´æ˜**:
- `category`: é…ç½®åˆ†ç±»é”®
- `category_name`: é…ç½®åˆ†ç±»æ˜¾ç¤ºåç§°
- `count`: è¯¥åˆ†ç±»ä¸‹çš„é…ç½®é¡¹æ•°é‡

---

### 2. è·å–æ‰€æœ‰é…ç½®ï¼ˆæŒ‰åˆ†ç±»åˆ†ç»„ï¼‰

**æ¥å£åœ°å€**: `GET /config/list`

**æ¥å£æè¿°**: è·å–æ‰€æœ‰é…ç½®é¡¹ï¼ŒæŒ‰åˆ†ç±»åˆ†ç»„è¿”å›ï¼Œç”¨äºå‰ç«¯tabé¡µé¢å±•ç¤º

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "category": "group",
      "category_name": "ç¾¤ç»„é…ç½®",
      "configs": [
        {
          "id": 1,
          "config_key": "group.notify_member_join",
          "config_value": "1",
          "config_type": "boolean",
          "description": "ç¾¤æˆå‘˜åŠ å…¥æ—¶æ˜¯å¦é€šçŸ¥å…¶ä»–æˆå‘˜",
          "category": "group",
          "is_editable": 1,
          "is_public": 1,
          "sort_order": 100,
          "version": 1,
          "created_at": "2025-01-17 23:22:43",
          "updated_at": "2025-01-17 23:22:43",
          "created_by": "system",
          "updated_by": "system"
        }
      ]
    }
  ]
}
```

---

### 3. æ ¹æ®åˆ†ç±»è·å–é…ç½®

**æ¥å£åœ°å€**: `GET /config/category/{category}`

**æ¥å£æè¿°**: æ ¹æ®æŒ‡å®šåˆ†ç±»è·å–è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰é…ç½®é¡¹

**è·¯å¾„å‚æ•°**:
- `category`: é…ç½®åˆ†ç±»ï¼ˆå¿…å¡«ï¼‰

**æ”¯æŒçš„åˆ†ç±»å€¼**: `group`, `system`, `security`, `notification`, `ui`, `message`, `file`, `robot`, `statistics`

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "category": "group",
    "category_name": "ç¾¤ç»„é…ç½®",
    "configs": [
      {
        "id": 1,
        "config_key": "group.notify_member_join",
        "config_value": "1",
        "config_type": "boolean",
        "description": "ç¾¤æˆå‘˜åŠ å…¥æ—¶æ˜¯å¦é€šçŸ¥å…¶ä»–æˆå‘˜",
        "is_editable": 1,
        "is_public": 1
      }
    ]
  }
}
```

---

### 4. æ›´æ–°å•ä¸ªé…ç½®

**æ¥å£åœ°å€**: `PUT /config/update`

**æ¥å£æè¿°**: æ›´æ–°æŒ‡å®šé…ç½®é¡¹çš„å€¼

**è¯·æ±‚å‚æ•°**:
```json
{
  "config_key": "group.notify_member_join",
  "config_value": "0"
}
```

**è¯·æ±‚å­—æ®µè¯´æ˜**:
- `config_key`: é…ç½®é”®ï¼ˆå¿…å¡«ï¼‰
- `config_value`: é…ç½®å€¼ï¼ˆå¿…å¡«ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success"
}
```

**æ³¨æ„äº‹é¡¹**:
- åªèƒ½æ›´æ–° `is_editable = 1` çš„é…ç½®é¡¹
- é…ç½®å€¼ä¼šæ ¹æ®é…ç½®ç±»å‹è¿›è¡ŒéªŒè¯
- æ›´æ–°åç‰ˆæœ¬å·ä¼šè‡ªåŠ¨é€’å¢

---

### 5. æ‰¹é‡æ›´æ–°é…ç½®

**æ¥å£åœ°å€**: `PUT /config/batch-update`

**æ¥å£æè¿°**: æ‰¹é‡æ›´æ–°å¤šä¸ªé…ç½®é¡¹çš„å€¼

**è¯·æ±‚å‚æ•°**:
```json
{
  "configs": [
    {
      "config_key": "group.notify_member_join",
      "config_value": "1"
    },
    {
      "config_key": "group.notify_member_leave",
      "config_value": "1"
    }
  ]
}
```

**è¯·æ±‚å­—æ®µè¯´æ˜**:
- `configs`: é…ç½®é¡¹æ•°ç»„ï¼ˆå¿…å¡«ï¼Œè‡³å°‘1é¡¹ï¼‰
  - `config_key`: é…ç½®é”®ï¼ˆå¿…å¡«ï¼‰
  - `config_value`: é…ç½®å€¼ï¼ˆå¿…å¡«ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success"
}
```

**æ³¨æ„äº‹é¡¹**:
- ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ‰¹é‡æ›´æ–°çš„ä¸€è‡´æ€§
- æ‰€æœ‰é…ç½®é¡¹å¿…é¡»å­˜åœ¨ä¸”å¯ç¼–è¾‘
- é…ç½®å€¼ä¼šè¿›è¡Œç±»å‹éªŒè¯

---

### 6. æœç´¢é…ç½®

**æ¥å£åœ°å€**: `POST /config/search`

**æ¥å£æè¿°**: æ ¹æ®å…³é”®è¯å’Œåˆ†ç±»æœç´¢é…ç½®é¡¹

**è¯·æ±‚å‚æ•°**:
```json
{
  "keyword": "ç¾¤ç»„",
  "category": "group",
  "page": 1,
  "page_size": 20
}
```

**è¯·æ±‚å­—æ®µè¯´æ˜**:
- `keyword`: æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰
- `category`: é…ç½®åˆ†ç±»ï¼ˆå¯é€‰ï¼‰
- `page`: é¡µç ï¼ˆå¿…å¡«ï¼Œæœ€å°1ï¼‰
- `page_size`: æ¯é¡µæ•°é‡ï¼ˆå¿…å¡«ï¼Œ1-100ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "configs": [
      {
        "id": 1,
        "config_key": "group.notify_member_join",
        "config_value": "1",
        "config_type": "boolean",
        "description": "ç¾¤æˆå‘˜åŠ å…¥æ—¶æ˜¯å¦é€šçŸ¥å…¶ä»–æˆå‘˜"
      }
    ],
    "total": 1,
    "page": 1,
    "page_size": 20
  }
}
```

---

### 7. è·å–å…¬å¼€é…ç½®

**æ¥å£åœ°å€**: `GET /config/public`

**æ¥å£æè¿°**: è·å–æ‰€æœ‰å…¬å¼€çš„é…ç½®é¡¹ï¼Œæ— éœ€æƒé™éªŒè¯

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "system.site_name": "å”åƒ§å¨å¨",
    "system.site_logo": "/assets/images/logo.png",
    "ui.theme": "light"
  }
}
```

**å“åº”å­—æ®µè¯´æ˜**:
- è¿”å› `is_public = 1` çš„é…ç½®é¡¹
- ä»¥ `config_key: config_value` çš„é”®å€¼å¯¹å½¢å¼è¿”å›

## ğŸ“Š é…ç½®æ•°æ®ç±»å‹

### 1. booleanç±»å‹
- æ”¯æŒå€¼: `"0"`, `"1"`, `"true"`, `"false"`
- ç¤ºä¾‹: å¼€å…³ç±»é…ç½®

### 2. numberç±»å‹
- æ”¯æŒå€¼: æ•°å­—å­—ç¬¦ä¸²
- ç¤ºä¾‹: æ•°é‡é™åˆ¶ã€æ—¶é—´è®¾ç½®

### 3. stringç±»å‹
- æ”¯æŒå€¼: ä»»æ„å­—ç¬¦ä¸²
- ç¤ºä¾‹: åç§°ã€æè¿°ã€è·¯å¾„

### 4. jsonç±»å‹
- æ”¯æŒå€¼: JSONæ ¼å¼å­—ç¬¦ä¸²
- ç¤ºä¾‹: å¤æ‚é…ç½®å¯¹è±¡

## ğŸ”’ æƒé™æ§åˆ¶

### é…ç½®æƒé™çº§åˆ«

1. **åªè¯»é…ç½®** (`is_editable = 0`)
   - æ™®é€šç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹
   - è¶…çº§ç®¡ç†å‘˜ä¹Ÿæ— æ³•ä¿®æ”¹

2. **å¯ç¼–è¾‘é…ç½®** (`is_editable = 1`)
   - è¶…çº§ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹
   - æ”¯æŒå•ä¸ªå’Œæ‰¹é‡æ›´æ–°

3. **å…¬å¼€é…ç½®** (`is_public = 1`)
   - å‰ç«¯å¯ä»¥è·å–
   - æ— éœ€æƒé™éªŒè¯

4. **ç§æœ‰é…ç½®** (`is_public = 0`)
   - ä»…åå°å¯è§
   - éœ€è¦ç®¡ç†å‘˜æƒé™

## ğŸ“ é…ç½®é¡¹ç¤ºä¾‹

### ç¾¤ç»„é…ç½®ç¤ºä¾‹
```json
{
  "group.notify_member_join": "1",
  "group.notify_member_leave": "1",
  "group.notify_member_kick": "1",
  "group.new_member_see_history": "1",
  "group.allow_member_invite": "1",
  "group.allow_member_pinned_message": "0",
  "group.max_member_count": "500",
  "group.auto_delete_inactive_days": "30"
}
```

### ç³»ç»Ÿé…ç½®ç¤ºä¾‹
```json
{
  "system.site_name": "å”åƒ§å¨å¨",
  "system.site_logo": "/assets/images/logo.png",
  "system.site_favicon": "/assets/images/favicon.ico",
  "system.default_avatar": "/assets/images/default_avatar.png",
  "system.welcome_message": "æ¬¢è¿ä½¿ç”¨å”åƒ§å¨å¨ï¼",
  "system.maintenance_mode": "0",
  "system.maintenance_message": "ç³»ç»Ÿæ­£åœ¨ç»´æŠ¤ä¸­ï¼Œè¯·ç¨åå†è¯•"
}
```

## âš ï¸ é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼å’Œå¿…å¡«é¡¹ |
| 401 | æœªæˆæƒ | æ£€æŸ¥JWT Tokenæ˜¯å¦æœ‰æ•ˆ |
| 403 | æƒé™ä¸è¶³ | ç¡®è®¤ç”¨æˆ·å…·æœ‰è¶…çº§ç®¡ç†å‘˜æƒé™ |
| 404 | é…ç½®ä¸å­˜åœ¨ | æ£€æŸ¥é…ç½®é”®æ˜¯å¦æ­£ç¡® |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ |

## ğŸ”§ å‰ç«¯é›†æˆå»ºè®®

### 1. Tabåˆ‡æ¢å®ç°
```javascript
// è·å–é…ç½®åˆ†ç±»
const categories = await api.get('/config/categories');

// æ ¹æ®åˆ†ç±»è·å–é…ç½®
const configs = await api.get(`/config/category/${category}`);

// æ¸²æŸ“é…ç½®è¡¨å•
renderConfigForm(configs);
```

### 2. é…ç½®æ›´æ–°
```javascript
// å•ä¸ªæ›´æ–°
await api.put('/config/update', {
  config_key: 'group.notify_member_join',
  config_value: '0'
});

// æ‰¹é‡æ›´æ–°
await api.put('/config/batch-update', {
  configs: [
    { config_key: 'key1', config_value: 'value1' },
    { config_key: 'key2', config_value: 'value2' }
  ]
});
```

### 3. æœç´¢åŠŸèƒ½
```javascript
const result = await api.post('/config/search', {
  keyword: 'ç¾¤ç»„',
  category: 'group',
  page: 1,
  page_size: 20
});
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜ç­–ç•¥**: ä¸ºé…ç½®æ•°æ®æ·»åŠ Redisç¼“å­˜
2. **åˆ†é¡µåŠ è½½**: å¤§é‡é…ç½®æ—¶ä½¿ç”¨åˆ†é¡µåŠ è½½
3. **æŒ‰éœ€åŠ è½½**: æ ¹æ®tabåˆ‡æ¢æŒ‰éœ€åŠ è½½é…ç½®
4. **æ‰¹é‡æ“ä½œ**: å¤šä¸ªé…ç½®æ›´æ–°æ—¶ä½¿ç”¨æ‰¹é‡æ¥å£

## ğŸ” è°ƒè¯•å’Œæµ‹è¯•

### 1. æ¥å£æµ‹è¯•
ä½¿ç”¨Postmanæˆ–å…¶ä»–APIæµ‹è¯•å·¥å…·æµ‹è¯•æ¥å£

### 2. æƒé™æµ‹è¯•
- ä½¿ç”¨æ™®é€šç”¨æˆ·Tokenæµ‹è¯•æƒé™æ§åˆ¶
- ä½¿ç”¨è¶…çº§ç®¡ç†å‘˜Tokenæµ‹è¯•å®Œæ•´åŠŸèƒ½

### 3. æ•°æ®éªŒè¯
- æµ‹è¯•ä¸åŒé…ç½®ç±»å‹çš„å€¼éªŒè¯
- æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚
