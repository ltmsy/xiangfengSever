# å…¨å±€æœç´¢æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è¿°

å…¨å±€æœç´¢æ¥å£æä¾›è·¨æ¨¡å—çš„ç»Ÿä¸€æœç´¢èƒ½åŠ›ï¼Œæ”¯æŒæœç´¢èŠå¤©å†…å®¹ã€ç”¨æˆ·ã€ç¾¤ç»„å’Œåº”ç”¨ã€‚è¯¥æ¥å£é‡‡ç”¨åˆ†ç±»å‹æœç´¢ç­–ç•¥ï¼Œæ”¯æŒå¤šç§è¿‡æ»¤æ¡ä»¶å’Œæ’åºæ–¹å¼ã€‚

## ğŸ”— æ¥å£ä¿¡æ¯

- **æ¥å£è·¯å¾„**: `POST /v1/message/global`
- **è¯·æ±‚æ–¹æ³•**: `POST`
- **è®¤è¯æ–¹å¼**: `Token Header`
- **å†…å®¹ç±»å‹**: `application/json`
- **æ¥å£æè¿°**: å…¨å±€æœç´¢æ¥å£ï¼Œæ”¯æŒå¤šç±»å‹å†…å®¹æœç´¢

## ğŸ“¥ è¯·æ±‚å‚æ•°

### è¯·æ±‚å¤´
```
token: {token}
Content-Type: application/json
```

### è¯·æ±‚ä½“
```json
{
  "keyword": "æœç´¢å…³é”®è¯",
  "search_types": ["chat", "user", "group", "app"],
  "filters": {
    "channel_id": "é™å®šé¢‘é“IDï¼ˆå¯é€‰ï¼‰",
    "channel_type": "é¢‘é“ç±»å‹ï¼ˆå¯é€‰ï¼‰",
    "content_type": "å†…å®¹ç±»å‹ï¼ˆå¯é€‰ï¼‰",
    "date_range": {
      "start_time": "2025-01-01 00:00:00",
      "end_time": "2025-12-31 23:59:59"
    },
    "file_types": ["image", "document", "video", "audio"]
  },
  "pagination": {
    "page": 1,
    "page_size": 20
  },
  "sort": {
    "field": "relevance",
    "order": "desc"
  }
}
```

### å‚æ•°è¯´æ˜

#### åŸºç¡€å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| keyword | string | æ˜¯ | æœç´¢å…³é”®è¯ï¼Œæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­— |
| search_types | array | æ˜¯ | æœç´¢ç±»å‹æ•°ç»„ï¼Œæ”¯æŒï¼šchat/user/group/app |

#### è¿‡æ»¤å‚æ•° (filters)
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| channel_id | string | å¦ | é™å®šæœç´¢çš„é¢‘é“ID |
| channel_type | uint8 | å¦ | é¢‘é“ç±»å‹ï¼š1-ä¸ªäººï¼Œ2-ç¾¤ç»„ |
| content_type | uint8 | å¦ | å†…å®¹ç±»å‹ï¼š1-æ–‡æœ¬ï¼Œ2-å›¾ç‰‡ï¼Œ3-è¯­éŸ³ï¼Œ4-è§†é¢‘ï¼Œ5-æ–‡ä»¶ |
| date_range.start_time | string | å¦ | æœç´¢å¼€å§‹æ—¶é—´ï¼Œæ ¼å¼ï¼š2025-01-01 00:00:00 |
| date_range.end_time | string | å¦ | æœç´¢ç»“æŸæ—¶é—´ï¼Œæ ¼å¼ï¼š2025-01-01 00:00:00 |
| file_types | array | å¦ | æ–‡ä»¶ç±»å‹è¿‡æ»¤ï¼šimage/document/video/audio |

#### åˆ†é¡µå‚æ•° (pagination)
| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|---------|------|
| page | uint32 | å¦ | 1 | é¡µç ï¼Œä»1å¼€å§‹ |
| page_size | uint32 | å¦ | 20 | æ¯é¡µæ•°é‡ï¼Œæœ€å¤§100 |

#### æ’åºå‚æ•° (sort)
| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|---------|------|
| field | string | å¦ | relevance | æ’åºå­—æ®µï¼šrelevance/time/name |
| order | string | å¦ | desc | æ’åºæ–¹å‘ï¼šasc/desc |

## ğŸ“¤ å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 150,
    "results": {
      "chat": {
        "total": 45,
        "items": [
          {
            "type": "chat",
            "message_id": "msg_123",
            "channel_id": "channel_001",
            "channel_type": 1,
            "from_uid": "user_001",
            "from_name": "å¼ ä¸‰",
            "content": "è¿™æ˜¯ä¸€æ¡åŒ…å«å…³é”®è¯çš„æ¶ˆæ¯å†…å®¹...",
            "content_type": 1,
            "timestamp": "2025-08-17 22:30:00",
            "relevance_score": 0.95,
            "highlight": {
              "content": "è¿™æ˜¯ä¸€æ¡åŒ…å«<em>å…³é”®è¯</em>çš„æ¶ˆæ¯å†…å®¹..."
            }
          }
        ]
      },
      "user": {
        "total": 12,
        "items": [
          {
            "type": "user",
            "uid": "user_002",
            "name": "æå››",
            "username": "lisi",
            "short_no": "ABC123",
            "avatar": "avatar_url",
            "relevance_score": 0.88,
            "highlight": {
              "name": "<em>æ</em>å››"
            }
          }
        ]
      },
      "group": {
        "total": 8,
        "items": [
          {
            "type": "group",
            "group_no": "group_001",
            "name": "æŠ€æœ¯äº¤æµç¾¤",
            "description": "è®¨è®ºæŠ€æœ¯é—®é¢˜çš„ç¾¤ç»„",
            "member_count": 150,
            "relevance_score": 0.82,
            "highlight": {
              "name": "æŠ€æœ¯äº¤æµ<em>ç¾¤</em>"
            }
          }
        ]
      },
      "app": {
        "total": 25,
        "items": [
          {
            "type": "app",
            "app_id": "app_001",
            "name": "æŠ€æœ¯æ–‡æ¡£",
            "description": "æŠ€æœ¯æ–‡æ¡£ç®¡ç†åº”ç”¨",
            "icon": "icon_url",
            "relevance_score": 0.78,
            "highlight": {
              "name": "æŠ€æœ¯<em>æ–‡æ¡£</em>"
            }
          }
        ]
      }
    }
  }
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "å‚æ•°é”™è¯¯",
  "data": null
}
```

## ğŸ” æœç´¢ç»“æœå­—æ®µè¯´æ˜

### èŠå¤©æ¶ˆæ¯ (chat)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| type | string | å›ºå®šå€¼ï¼š"chat" |
| message_id | string | æ¶ˆæ¯å”¯ä¸€ID |
| channel_id | string | é¢‘é“ID |
| channel_type | uint8 | é¢‘é“ç±»å‹ï¼š1-ä¸ªäººï¼Œ2-ç¾¤ç»„ |
| from_uid | string | å‘é€è€…UID |
| from_name | string | å‘é€è€…æ˜µç§° |
| content | string | æ¶ˆæ¯å†…å®¹ï¼ˆæˆªå–ç‰‡æ®µï¼‰ |
| content_type | uint8 | å†…å®¹ç±»å‹ï¼š1-æ–‡æœ¬ï¼Œ2-å›¾ç‰‡ï¼Œ3-è¯­éŸ³ï¼Œ4-è§†é¢‘ï¼Œ5-æ–‡ä»¶ |
| timestamp | string | æ¶ˆæ¯æ—¶é—´ï¼ˆæ ¼å¼ï¼š2025-01-01 00:00:00ï¼‰ |
| relevance_score | float64 | ç›¸å…³åº¦è¯„åˆ† (0-1) |
| highlight.content | string | é«˜äº®æ˜¾ç¤ºçš„å†…å®¹ |

### ç”¨æˆ· (user)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| type | string | å›ºå®šå€¼ï¼š"user" |
| uid | string | ç”¨æˆ·UID |
| name | string | ç”¨æˆ·æ˜µç§° |
| username | string | ç”¨æˆ·åï¼ˆzone+phoneæ ¼å¼ï¼‰ |
| short_no | string | çŸ­ç¼–å· |
| avatar | string | å¤´åƒURLï¼ˆæš‚æ—¶ä¸ºç©ºï¼‰ |
| relevance_score | float64 | ç›¸å…³åº¦è¯„åˆ† (0-1) |
| highlight.name | string | é«˜äº®æ˜¾ç¤ºçš„æ˜µç§° |

### ç¾¤ç»„ (group)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| type | string | å›ºå®šå€¼ï¼š"group" |
| group_no | string | ç¾¤ç»„ç¼–å· |
| name | string | ç¾¤ç»„åç§° |
| description | string | ç¾¤ç»„æè¿°ï¼ˆnoticeå­—æ®µï¼‰ |
| member_count | uint32 | æˆå‘˜æ•°é‡ |
| relevance_score | float64 | ç›¸å…³åº¦è¯„åˆ† (0-1) |
| highlight.name | string | é«˜äº®æ˜¾ç¤ºçš„ç¾¤ç»„å |

### åº”ç”¨ (app)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| type | string | å›ºå®šå€¼ï¼š"app" |
| app_id | string | åº”ç”¨ID |
| name | string | åº”ç”¨åç§° |
| description | string | åº”ç”¨æè¿° |
| icon | string | åº”ç”¨å›¾æ ‡URL |
| relevance_score | float64 | ç›¸å…³åº¦è¯„åˆ† (0-1) |
| highlight.name | string | é«˜äº®æ˜¾ç¤ºçš„åº”ç”¨å |

## ğŸš€ å®ç°æ–¹æ¡ˆ

### 1. æ¶æ„è®¾è®¡
```
å®¢æˆ·ç«¯ â†’ APIç½‘å…³ â†’ æ¶ˆæ¯æ¨¡å— â†’ æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢
```

### 2. æœç´¢ç­–ç•¥
- **èŠå¤©å†…å®¹**: ç›´æ¥æŸ¥è¯¢æœ¬åœ°æ•°æ®åº“ï¼Œæ”¯æŒåˆ†è¡¨æŸ¥è¯¢ï¼ˆmessage, message1, message2ç­‰ï¼‰
- **ç”¨æˆ·**: æ•°æ®åº“æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆå§“åã€ç”¨æˆ·åã€çŸ­ç¼–å·ã€æ‰‹æœºå·ï¼‰
- **ç¾¤ç»„**: æ•°æ®åº“æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆåç§°ã€ç¼–å·ã€åˆ†ç±»ï¼‰+ æˆå‘˜æ•°ç»Ÿè®¡
- **åº”ç”¨**: æ•°æ®åº“æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆåç§°ã€æè¿°ã€åˆ†ç±»ï¼‰

### 3. æ€§èƒ½ä¼˜åŒ–
- å¹¶å‘æœç´¢å¤„ç†
- æ™ºèƒ½ç›¸å…³åº¦è¯„åˆ†
- åˆ†é¡µåŠ è½½
- å…³é”®è¯é«˜äº®

### 4. å®‰å…¨è€ƒè™‘
- ç”¨æˆ·æƒé™éªŒè¯ï¼ˆtokenè®¤è¯ï¼‰
- æœç´¢ç»“æœæƒé™è¿‡æ»¤
- æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æœç´¢èŠå¤©å†…å®¹
```json
{
  "keyword": "æŠ€æœ¯è®¨è®º",
  "search_types": ["chat"],
  "filters": {
    "content_type": 1,
    "date_range": {
      "start_time": "2025-08-01 00:00:00",
      "end_time": "2025-08-17 23:59:59"
    }
  },
  "pagination": {
    "page": 1,
    "page_size": 10
  }
}
```

### æœç´¢ç”¨æˆ·
```json
{
  "keyword": "å¼ ä¸‰",
  "search_types": ["user"],
  "pagination": {
    "page": 1,
    "page_size": 20
  }
}
```

### æœç´¢ç¾¤ç»„
```json
{
  "keyword": "æŠ€æœ¯äº¤æµ",
  "search_types": ["group"],
  "pagination": {
    "page": 1,
    "page_size": 15
  }
}
```

### æœç´¢åº”ç”¨
```json
{
  "keyword": "æ–‡æ¡£ç®¡ç†",
  "search_types": ["app"],
  "pagination": {
    "page": 1,
    "page_size": 10
  }
}
```

### å…¨å±€æœç´¢
```json
{
  "keyword": "æŠ€æœ¯",
  "search_types": ["chat", "user", "group", "app"],
  "pagination": {
    "page": 1,
    "page_size": 20
  },
  "sort": {
    "field": "relevance",
    "order": "desc"
  }
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æœç´¢æƒé™**: åªèƒ½æœç´¢ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„å†…å®¹
2. **ç»“æœé™åˆ¶**: æ¯é¡µæœ€å¤§è¿”å›100æ¡ç»“æœ
3. **å…³é”®è¯é•¿åº¦**: å…³é”®è¯é•¿åº¦å»ºè®®åœ¨1-50ä¸ªå­—ç¬¦ä¹‹é—´
4. **æœç´¢é¢‘ç‡**: å»ºè®®é™åˆ¶æœç´¢é¢‘ç‡ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—èµ„æº
5. **åˆ†è¡¨å¤„ç†**: èŠå¤©æ¶ˆæ¯æ”¯æŒåˆ†è¡¨æŸ¥è¯¢ï¼Œè‡ªåŠ¨éå†æ‰€æœ‰æ¶ˆæ¯è¡¨
6. **ç›¸å…³åº¦ç®—æ³•**: ä½¿ç”¨æ™ºèƒ½è¯„åˆ†ç®—æ³•ï¼Œæ”¯æŒå‰ç¼€åŒ¹é…å’Œå†…å®¹åŒ¹é…

## ğŸ”„ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| 1.0.0 | 2025-08-17 | åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºç¡€æœç´¢åŠŸèƒ½ |
| 1.1.0 | 2025-08-17 | å®Œå–„æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢ï¼Œæ”¯æŒåˆ†è¡¨ã€ç›¸å…³åº¦è¯„åˆ†ã€å…³é”®è¯é«˜äº® |
