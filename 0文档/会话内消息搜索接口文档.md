# ä¼šè¯å†…æ¶ˆæ¯æœç´¢æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è¿°

ä¼šè¯å†…æ¶ˆæ¯æœç´¢æ¥å£ä¸“é—¨ç”¨äºåœ¨ç§èŠæˆ–ç¾¤èŠä¼šè¯ä¸­æœç´¢ç‰¹å®šæ¶ˆæ¯ã€‚è¯¥æ¥å£é‡‡ç”¨**ä¸¤æ­¥å¼æœç´¢**æµç¨‹ï¼š
1. **æ‰¹é‡æœç´¢** â†’ è¿”å›æ¶ˆæ¯åˆ—è¡¨
2. **å•æ¡é”å®š** â†’ å®šä½åˆ°å…·ä½“æ¶ˆæ¯ä½ç½®

## ğŸ”— æ¥å£ä¿¡æ¯

### æ¥å£1ï¼šä¼šè¯å†…æ¶ˆæ¯æœç´¢
- **æ¥å£è·¯å¾„**: `POST /v1/message/conversation/search`
- **è¯·æ±‚æ–¹æ³•**: `POST`
- **è®¤è¯æ–¹å¼**: `Token Header`
- **å†…å®¹ç±»å‹**: `application/json`
- **æ¥å£æè¿°**: æ‰¹é‡æœç´¢ä¼šè¯å†…æ¶ˆæ¯ï¼Œè¿”å›æ¶ˆæ¯åˆ—è¡¨

### æ¥å£2ï¼šæ¶ˆæ¯å®šä½
- **æ¥å£è·¯å¾„**: `POST /v1/message/conversation/locate`
- **è¯·æ±‚æ–¹æ³•**: `POST`
- **è®¤è¯æ–¹å¼**: `Token Header`
- **å†…å®¹ç±»å‹**: `application/json`
- **æ¥å£æè¿°**: å®šä½å…·ä½“æ¶ˆæ¯ï¼Œè·å–æ¶ˆæ¯è¯¦æƒ…å’Œä½ç½®ä¿¡æ¯

## ğŸ“¥ è¯·æ±‚å‚æ•°

### æ¥å£1ï¼šä¼šè¯å†…æ¶ˆæ¯æœç´¢

#### è¯·æ±‚å¤´
```
token: {token}
Content-Type: application/json
```

#### è¯·æ±‚ä½“
```json
{
  "keyword": "æœç´¢å…³é”®è¯",
  "channel_id": "ä¼šè¯ID",
  "channel_type": 1,
  "content_type": 0,
  "date_range": {
    "start_time": "2025-01-01 00:00:00",
    "end_time": "2025-12-31 23:59:59"
  },
  "pagination": {
    "page": 1,
    "page_size": 20
  },
  "sort": {
    "field": "time",
    "order": "desc"
  }
}
```

### æ¥å£2ï¼šæ¶ˆæ¯å®šä½

#### è¯·æ±‚ä½“
```json
{
  "message_id": "æ¶ˆæ¯ID",
  "channel_id": "ä¼šè¯ID",
  "channel_type": 1
}
```

### å‚æ•°è¯´æ˜

#### åŸºç¡€å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| keyword | string | æ˜¯ | æœç´¢å…³é”®è¯ï¼Œæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­— |
| channel_id | string | æ˜¯ | ä¼šè¯IDï¼ˆç§èŠæ—¶ä¸ºå¯¹æ–¹ç”¨æˆ·IDï¼Œç¾¤èŠæ—¶ä¸ºç¾¤ç»„ç¼–å·ï¼‰ |
| channel_type | uint8 | æ˜¯ | ä¼šè¯ç±»å‹ï¼š1-ç§èŠï¼Œ2-ç¾¤èŠ |
| message_id | string | æ˜¯ | æ¶ˆæ¯IDï¼ˆä»…å®šä½æ¥å£éœ€è¦ï¼‰ |

#### è¿‡æ»¤å‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| content_type | uint8 | å¦ | å†…å®¹ç±»å‹ï¼š0-å…¨éƒ¨ï¼Œ1-æ–‡æœ¬ï¼Œ2-å›¾ç‰‡ï¼Œ3-è¯­éŸ³ï¼Œ4-è§†é¢‘ï¼Œ5-æ–‡ä»¶ |
| date_range.start_time | string | å¦ | æœç´¢å¼€å§‹æ—¶é—´ï¼Œæ ¼å¼ï¼š2025-01-01 00:00:00 |
| date_range.end_time | string | å¦ | æœç´¢ç»“æŸæ—¶é—´ï¼Œæ ¼å¼ï¼š2025-01-01 00:00:00 |

#### åˆ†é¡µå‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|---------|------|
| page | uint32 | å¦ | 1 | é¡µç ï¼Œä»1å¼€å§‹ |
| page_size | uint32 | å¦ | 20 | æ¯é¡µæ•°é‡ï¼Œæœ€å¤§100 |

#### æ’åºå‚æ•°
| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|---------|------|
| field | string | å¦ | time | æ’åºå­—æ®µï¼štime/relevance |
| order | string | å¦ | desc | æ’åºæ–¹å‘ï¼šasc/desc |

## ğŸ“¤ å“åº”æ ¼å¼

### æ¥å£1ï¼šä¼šè¯å†…æ¶ˆæ¯æœç´¢ - æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 45,
    "results": [
      {
        "message_id": "msg_123",
        "from_uid": "user_001",
        "from_name": "å¼ ä¸‰",
        "content": "è¿™æ˜¯ä¸€æ¡åŒ…å«å…³é”®è¯çš„æ¶ˆæ¯å†…å®¹...",
        "content_type": 1,
        "timestamp": "2025-08-17 22:30:00",
        "relevance_score": 0.95,
        "highlight": {
          "content": "è¿™æ˜¯ä¸€æ¡åŒ…å«<em>å…³é”®è¯</em>çš„æ¶ˆæ¯å†…å®¹..."
        },
        "is_read": true,
        "is_deleted": false,
        "is_revoked": false,
        "position": {
          "table_name": "message",
          "table_index": 0,
          "global_index": 15
        }
      }
    ]
  }
}
```

### æ¥å£2ï¼šæ¶ˆæ¯å®šä½ - æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "message": {
      "message_id": "msg_123",
      "from_uid": "user_001",
      "from_name": "å¼ ä¸‰",
      "content": "å®Œæ•´æ¶ˆæ¯å†…å®¹",
      "content_type": 1,
      "timestamp": "2025-08-17 22:30:00",
      "relevance_score": 1.0,
      "highlight": {
        "content": "å®Œæ•´æ¶ˆæ¯å†…å®¹"
      },
      "is_read": true,
      "is_deleted": false,
      "is_revoked": false,
      "position": {
        "table_name": "message",
        "table_index": 0,
        "global_index": 0
      }
    },
    "position": {
      "page": 3,
      "index": 15,
      "total_count": 150,
      "table_name": "message",
      "table_index": 0
    }
  }
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "å‚æ•°é”™è¯¯",
  "data": null
}
```

## ğŸ” å“åº”å­—æ®µè¯´æ˜

### æœç´¢æ¥å£ç»“æœå­—æ®µ
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| total | int64 | æœç´¢ç»“æœæ€»æ•° |
| results | array | æœç´¢ç»“æœæ•°ç»„ |

### æ¶ˆæ¯ç»“æœå­—æ®µ
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| message_id | string | æ¶ˆæ¯å”¯ä¸€ID |
| from_uid | string | å‘é€è€…UID |
| from_name | string | å‘é€è€…æ˜µç§° |
| content | string | æ¶ˆæ¯å†…å®¹ï¼ˆæˆªå–ç‰‡æ®µï¼‰ |
| content_type | uint8 | å†…å®¹ç±»å‹ï¼š1-æ–‡æœ¬ï¼Œ2-å›¾ç‰‡ï¼Œ3-è¯­éŸ³ï¼Œ4-è§†é¢‘ï¼Œ5-æ–‡ä»¶ |
| timestamp | string | æ¶ˆæ¯æ—¶é—´ï¼ˆæ ¼å¼ï¼š2025-01-01 00:00:00ï¼‰ |
| relevance_score | float64 | ç›¸å…³åº¦è¯„åˆ† (0-1) |
| highlight.content | string | é«˜äº®æ˜¾ç¤ºçš„å†…å®¹ |
| is_read | bool | æ˜¯å¦å·²è¯» |
| is_deleted | bool | æ˜¯å¦å·²åˆ é™¤ |
| is_revoked | bool | æ˜¯å¦å·²æ’¤å› |
| position.table_name | string | æ‰€åœ¨è¡¨å |
| position.table_index | int | åœ¨è¡¨ä¸­çš„ç´¢å¼• |
| position.global_index | int64 | å…¨å±€æ¶ˆæ¯ç´¢å¼• |

### å®šä½æ¥å£ä½ç½®å­—æ®µ
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| page | int | æ‰€åœ¨é¡µç ï¼ˆåŸºäºæ¯é¡µ20æ¡è®¡ç®—ï¼‰ |
| index | int | åœ¨é¡µé¢ä¸­çš„ç´¢å¼• |
| total_count | int64 | ä¼šè¯æ€»æ¶ˆæ¯æ•° |
| table_name | string | æ‰€åœ¨è¡¨å |
| table_index | int | åœ¨è¡¨ä¸­çš„ç´¢å¼• |

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### 1. ä¸¤æ­¥å¼æœç´¢æµç¨‹
- **ç¬¬ä¸€æ­¥ï¼šæ‰¹é‡æœç´¢** - è·å–ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰æ¶ˆæ¯åˆ—è¡¨
- **ç¬¬äºŒæ­¥ï¼šå•æ¡é”å®š** - æ ¹æ®æ¶ˆæ¯IDå®šä½åˆ°å…·ä½“ä½ç½®

### 2. æƒé™æ§åˆ¶
- éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®æŒ‡å®šä¼šè¯
- ç§èŠï¼šæ£€æŸ¥æ˜¯å¦æ˜¯ä¼šè¯å‚ä¸è€…
- ç¾¤èŠï¼šæ£€æŸ¥æ˜¯å¦æ˜¯ç¾¤æˆå‘˜

### 3. æœç´¢èƒ½åŠ›
- æ”¯æŒåˆ†è¡¨æŸ¥è¯¢ï¼ˆmessage, message1, message2ç­‰ï¼‰
- å…³é”®è¯æ¨¡ç³ŠåŒ¹é…ï¼ˆpayloadå’Œheaderå­—æ®µï¼‰
- å†…å®¹ç±»å‹è¿‡æ»¤
- æ—¶é—´èŒƒå›´è¿‡æ»¤

### 4. ç»“æœå¤„ç†
- æ™ºèƒ½ç›¸å…³åº¦è¯„åˆ†
- å…³é”®è¯é«˜äº®æ˜¾ç¤º
- æ”¯æŒæŒ‰æ—¶é—´æˆ–ç›¸å…³åº¦æ’åº
- åˆ†é¡µåŠ è½½

### 5. ä½ç½®ä¿¡æ¯
- æä¾›æ¶ˆæ¯åœ¨æ•°æ®åº“ä¸­çš„ä½ç½®ä¿¡æ¯
- è®¡ç®—æ¶ˆæ¯åœ¨ä¼šè¯ä¸­çš„é¡µç å’Œç´¢å¼•
- æ”¯æŒå‰ç«¯ç²¾ç¡®å®šä½å’Œè·³è½¬

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´æœç´¢æµç¨‹ç¤ºä¾‹

#### æ­¥éª¤1ï¼šæœç´¢æ¶ˆæ¯åˆ—è¡¨
```json
POST /v1/message/conversation/search
{
  "keyword": "æŠ€æœ¯è®¨è®º",
  "channel_id": "user_123",
  "channel_type": 1,
  "content_type": 1,
  "pagination": {
    "page": 1,
    "page_size": 10
  }
}
```

#### æ­¥éª¤2ï¼šå®šä½å…·ä½“æ¶ˆæ¯
```json
POST /v1/message/conversation/locate
{
  "message_id": "msg_123",
  "channel_id": "user_123",
  "channel_type": 1
}
```

### æœç´¢ç§èŠæ¶ˆæ¯
```json
{
  "keyword": "æŠ€æœ¯è®¨è®º",
  "channel_id": "user_123",
  "channel_type": 1,
  "content_type": 1,
  "date_range": {
    "start_time": "2025-08-01 00:00:00",
    "end_time": "2025-08-17 23:59:59"
  },
  "pagination": {
    "page": 1,
    "page_size": 10
  },
  "sort": {
    "field": "time",
    "order": "desc"
  }
}
```

### æœç´¢ç¾¤èŠæ¶ˆæ¯
```json
{
  "keyword": "ä¼šè®®å®‰æ’",
  "channel_id": "group_456",
  "channel_type": 2,
  "content_type": 0,
  "pagination": {
    "page": 1,
    "page_size": 20
  },
  "sort": {
    "field": "relevance",
    "order": "desc"
  }
}
```

### æœç´¢å›¾ç‰‡æ¶ˆæ¯
```json
{
  "keyword": "æˆªå›¾",
  "channel_id": "user_789",
  "channel_type": 1,
  "content_type": 2,
  "pagination": {
    "page": 1,
    "page_size": 15
  }
}
```

## ğŸ”„ å‰ç«¯é›†æˆæµç¨‹

### 1. æœç´¢é˜¶æ®µ
1. ç”¨æˆ·åœ¨ä¼šè¯ç•Œé¢è¾“å…¥å…³é”®è¯
2. è°ƒç”¨æœç´¢æ¥å£è·å–æ¶ˆæ¯åˆ—è¡¨
3. åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºæœç´¢ç»“æœï¼ˆæ”¯æŒé«˜äº®ï¼‰

### 2. å®šä½é˜¶æ®µ
1. ç”¨æˆ·ç‚¹å‡»æœç´¢ç»“æœä¸­çš„æŸæ¡æ¶ˆæ¯
2. è°ƒç”¨å®šä½æ¥å£è·å–æ¶ˆæ¯è¯¦æƒ…å’Œä½ç½®
3. æ ¹æ®ä½ç½®ä¿¡æ¯è·³è½¬åˆ°å…·ä½“æ¶ˆæ¯ä½ç½®
4. é«˜äº®æ˜¾ç¤ºå®šä½åˆ°çš„æ¶ˆæ¯

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æ”¯æŒå®æ—¶æœç´¢ï¼ˆè¾“å…¥æ—¶å³æ—¶æœç´¢ï¼‰
- æœç´¢ç»“æœç¼“å­˜
- å¹³æ»‘çš„è·³è½¬åŠ¨ç”»
- æ¶ˆæ¯é«˜äº®å’Œèšç„¦æ•ˆæœ

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™éªŒè¯**: åªèƒ½æœç´¢ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„ä¼šè¯
2. **ä¼šè¯ç±»å‹**: channel_typeå¿…é¡»æ­£ç¡®æŒ‡å®šï¼ˆ1-ç§èŠï¼Œ2-ç¾¤èŠï¼‰
3. **ç»“æœé™åˆ¶**: æ¯é¡µæœ€å¤§è¿”å›100æ¡ç»“æœ
4. **å…³é”®è¯é•¿åº¦**: å…³é”®è¯é•¿åº¦å»ºè®®åœ¨1-50ä¸ªå­—ç¬¦ä¹‹é—´
5. **åˆ†è¡¨å¤„ç†**: è‡ªåŠ¨éå†æ‰€æœ‰æ¶ˆæ¯è¡¨è¿›è¡Œæœç´¢
6. **æ—¶é—´æ ¼å¼**: æ—¶é—´æ ¼å¼å¿…é¡»ä¸º "2025-01-01 00:00:00"
7. **ä¸¤æ­¥æµç¨‹**: å…ˆæœç´¢åå®šä½ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒæµç•…

## ğŸ”„ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| 1.0.0 | 2025-08-17 | åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒä¼šè¯å†…æ¶ˆæ¯æœç´¢ |
| 1.1.0 | 2025-08-17 | å¢åŠ æ¶ˆæ¯å®šä½æ¥å£ï¼Œå®Œå–„ä¸¤æ­¥å¼æœç´¢æµç¨‹ |

## ğŸ”— ç›¸å…³æ¥å£

- [å…¨å±€æœç´¢æ¥å£](./å…¨å±€æœç´¢æ¥å£æ–‡æ¡£.md) - è·¨ä¼šè¯çš„å…¨å±€æœç´¢
- [æ¶ˆæ¯åˆ—è¡¨æ¥å£](./æ¶ˆæ¯æŸ¥çœ‹æ–‡æ¡£.md) - è·å–ä¼šè¯æ¶ˆæ¯åˆ—è¡¨
- [æ¶ˆæ¯è¯¦æƒ…æ¥å£](./æ¶ˆæ¯æŸ¥çœ‹æ–‡æ¡£.md) - è·å–æ¶ˆæ¯è¯¦ç»†ä¿¡æ¯ 