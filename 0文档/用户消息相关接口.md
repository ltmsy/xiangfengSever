# å”åƒ§å¨å¨ - ç”¨æˆ·æ¶ˆæ¯ç›¸å…³æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è§ˆ

å”åƒ§å¨å¨æä¾›äº†å®Œæ•´çš„åå°ç®¡ç†æ¥å£æ¥æŸ¥çœ‹å’Œç®¡ç†ç”¨æˆ·æ¶ˆæ¯ï¼ŒåŒ…æ‹¬æ¶ˆæ¯æŸ¥çœ‹ã€å‘é€ã€åˆ é™¤ç­‰åŠŸèƒ½ã€‚

## ğŸ” è®¤è¯æ¥å£

### ç®¡ç†å‘˜ç™»å½•
```http
POST /v1/manager/login
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "username": "admin",
  "password": "admiN123456"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "uid": "admin",
  "token": "925d0793a63e45bba1a18e0ad17ed381",
  "name": "è¶…çº§ç®¡ç†å‘˜",
  "role": "superAdmin"
}
```

**è¯´æ˜ï¼š**
- ä½¿ç”¨è¶…çº§ç®¡ç†å‘˜è´¦å·ç™»å½•
- è¿”å›çš„tokenéœ€è¦åœ¨åç»­è¯·æ±‚çš„Headerä¸­æºå¸¦
- Headeræ ¼å¼ï¼š`token: {tokenå€¼}`

## ğŸ“ æ¶ˆæ¯æŸ¥çœ‹æ¥å£

### 1. æŸ¥çœ‹ä»£å‘æ¶ˆæ¯è®°å½•
```http
GET /v1/manager/message?page={é¡µç }&page_size={æ¯é¡µæ•°é‡}
```

**è¯·æ±‚å‚æ•°ï¼š**
- `page`: é¡µç ï¼Œä»1å¼€å§‹
- `page_size`: æ¯é¡µæ•°é‡ï¼Œå»ºè®®10-100

**è¯·æ±‚å¤´ï¼š**
```
token: {ç®¡ç†å‘˜token}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "count": 0,
  "list": []
}
```

**åŠŸèƒ½è¯´æ˜ï¼š**
- æŸ¥çœ‹ç®¡ç†å‘˜ä»£å‘çš„æ¶ˆæ¯å†å²è®°å½•
- éœ€è¦ç®¡ç†å‘˜æƒé™

### 2. æŸ¥çœ‹é¢‘é“æ¶ˆæ¯è®°å½•
```http
GET /v1/manager/message/record?channel_id={é¢‘é“ID}&page={é¡µç }&page_size={æ¯é¡µæ•°é‡}
```

**è¯·æ±‚å‚æ•°ï¼š**
- `channel_id`: é¢‘é“IDï¼ˆç¾¤ç»„IDï¼‰
- `page`: é¡µç ï¼Œä»1å¼€å§‹
- `page_size`: æ¯é¡µæ•°é‡

**è¯·æ±‚å¤´ï¼š**
```
token: {ç®¡ç†å‘˜token}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "count": 150,
  "list": [
    {
      "message_id": "123456",
      "message_seq": 100,
      "sender": "user123",
      "sender_name": "å¼ ä¸‰",
      "payload": {
        "content": "ä½ å¥½ï¼",
        "type": 1
      },
      "is_deleted": 0,
      "readed_count": 1,
      "revoke": 0,
      "device_db_id": 1,
      "device_id": "iPhone_123",
      "device_name": "iPhone 15",
      "device_model": "iPhone 15 Pro",
      "created_at": "2024-01-01 12:00:00"
    }
  ]
}
```

**åŠŸèƒ½è¯´æ˜ï¼š**
- æŸ¥çœ‹æŒ‡å®šé¢‘é“ï¼ˆç¾¤ç»„ï¼‰çš„æ‰€æœ‰æ¶ˆæ¯
- åŒ…å«å‘é€è€…ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ã€æ¶ˆæ¯å†…å®¹ç­‰
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢

### 3. æŸ¥çœ‹å•èŠæ¶ˆæ¯è®°å½•
```http
GET /v1/manager/message/recordpersonal?uid={ç”¨æˆ·1}&touid={ç”¨æˆ·2}&page={é¡µç }&page_size={æ¯é¡µæ•°é‡}
```

**è¯·æ±‚å‚æ•°ï¼š**
- `uid`: å…¶ä¸­ä¸€ä¸ªç”¨æˆ·çš„ID
- `touid`: å¦ä¸€ä¸ªç”¨æˆ·çš„ID
- `page`: é¡µç ï¼Œä»1å¼€å§‹
- `page_size`: æ¯é¡µæ•°é‡

**è¯·æ±‚å¤´ï¼š**
```
token: {ç®¡ç†å‘˜token}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "count": 50,
  "list": [
    {
      "message_id": "123456",
      "sender": "user1",
      "sender_name": "å¼ ä¸‰",
      "payload": {
        "content": "ç§èŠæ¶ˆæ¯å†…å®¹",
        "type": 1
      },
      "signal": 0,
      "is_deleted": 0,
      "readed_count": 1,
      "revoke": 0,
      "device_db_id": 1,
      "device_id": "iPhone_123",
      "device_name": "iPhone 15",
      "device_model": "iPhone 15 Pro",
      "created_at": "2024-01-01 12:00:00"
    }
  ]
}
```

**åŠŸèƒ½è¯´æ˜ï¼š**
- æŸ¥çœ‹ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„ç§èŠè®°å½•
- åŒ…å«å®Œæ•´çš„æ¶ˆæ¯å†…å®¹å’Œå…ƒæ•°æ®
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢

## ğŸ“¤ æ¶ˆæ¯å‘é€æ¥å£

### 4. å‘é€æ¶ˆæ¯
```http
POST /v1/manager/message/send
```

**è¯·æ±‚å¤´ï¼š**
```
token: {è¶…çº§ç®¡ç†å‘˜token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "sender": "admin",
  "sender_name": "ç³»ç»Ÿç®¡ç†å‘˜",
  "received_channel_id": "user123",
  "received_channel_type": 1,
  "content": "ç³»ç»Ÿé€šçŸ¥æ¶ˆæ¯"
}
```

**å‚æ•°è¯´æ˜ï¼š**
- `sender`: å‘é€è€…UID
- `sender_name`: å‘é€è€…åç§°
- `received_channel_id`: æ¥æ”¶è€…é¢‘é“IDï¼ˆç”¨æˆ·IDæˆ–ç¾¤ç»„IDï¼‰
- `received_channel_type`: é¢‘é“ç±»å‹ï¼ˆ1: ä¸ªäºº, 2: ç¾¤ç»„ï¼‰
- `content`: æ¶ˆæ¯å†…å®¹

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": 200
}
```

**æƒé™è¦æ±‚ï¼š**
- éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™

### 5. ç»™å¥½å‹å‘é€æ¶ˆæ¯
```http
POST /v1/manager/message/sendfriends
```

**è¯·æ±‚å¤´ï¼š**
```
token: {è¶…çº§ç®¡ç†å‘˜token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "uid": "user123",
  "to_uids": ["user456", "user789"],
  "content": "ç¾¤å‘æ¶ˆæ¯å†…å®¹"
}
```

**å‚æ•°è¯´æ˜ï¼š**
- `uid`: å‘é€è€…UID
- `to_uids`: æ¥æ”¶è€…UIDåˆ—è¡¨
- `content`: æ¶ˆæ¯å†…å®¹

**æƒé™è¦æ±‚ï¼š**
- éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™

### 6. ç»™æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯
```http
POST /v1/manager/message/sendall
```

**è¯·æ±‚å¤´ï¼š**
```
token: {è¶…çº§ç®¡ç†å‘˜token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "content": "ç³»ç»Ÿå…¬å‘Šï¼šå¹³å°ç»´æŠ¤é€šçŸ¥"
}
```

**å‚æ•°è¯´æ˜ï¼š**
- `content`: æ¶ˆæ¯å†…å®¹

**åŠŸèƒ½è¯´æ˜ï¼š**
- ç»™å¹³å°æ‰€æœ‰ç”¨æˆ·å‘é€ç³»ç»Ÿæ¶ˆæ¯
- åˆ†æ‰¹å‘é€ï¼Œé¿å…ç³»ç»Ÿå‹åŠ›è¿‡å¤§

**æƒé™è¦æ±‚ï¼š**
- éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™

## ğŸ—‘ï¸ æ¶ˆæ¯ç®¡ç†æ¥å£

### 7. åˆ é™¤æ¶ˆæ¯
```http
DELETE /v1/manager/message
```

**è¯·æ±‚å¤´ï¼š**
```
token: {è¶…çº§ç®¡ç†å‘˜token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "list": [
    {
      "message_id": "123456",
      "message_seq": 100
    }
  ],
  "channel_id": "group123",
  "from_uid": "user123",
  "channel_type": 2
}
```

**å‚æ•°è¯´æ˜ï¼š**
- `list`: è¦åˆ é™¤çš„æ¶ˆæ¯åˆ—è¡¨
- `channel_id`: é¢‘é“ID
- `from_uid`: å‘é€è€…UIDï¼ˆå•èŠæ—¶å¿…å¡«ï¼‰
- `channel_type`: é¢‘é“ç±»å‹ï¼ˆ1: ä¸ªäºº, 2: ç¾¤ç»„ï¼‰

**æƒé™è¦æ±‚ï¼š**
- éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™

## ğŸš« å†…å®¹ç®¡ç†æ¥å£

### 8. æŸ¥è¯¢è¿ç¦è¯
```http
GET /v1/manager/message/prohibit_words?page={é¡µç }&page_size={æ¯é¡µæ•°é‡}&search_key={æœç´¢å…³é”®è¯}
```

**è¯·æ±‚å‚æ•°ï¼š**
- `page`: é¡µç 
- `page_size`: æ¯é¡µæ•°é‡
- `search_key`: æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "list": [
    {
      "id": 1,
      "content": "è¿ç¦è¯å†…å®¹",
      "is_deleted": 0,
      "version": 1,
      "created_at": "2024-01-01 12:00:00"
    }
  ],
  "count": 10
}
```

### 9. æ·»åŠ è¿ç¦è¯
```http
POST /v1/manager/message/prohibit_words
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "content": "æ–°çš„è¿ç¦è¯"
}
```

### 10. åˆ é™¤è¿ç¦è¯
```http
DELETE /v1/manager/message/prohibit_words
```

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "id": 1
}
```

## ğŸ”§ æ¥å£ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´æµ‹è¯•æµç¨‹

```bash
# 1. ç™»å½•è·å–Token
TOKEN=$(curl -s -X POST http://localhost:8090/v1/manager/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admiN123456"}' | \
  grep -o '"token":"[^"]*"' | cut -d'"' -f4)

echo "Token: $TOKEN"

# 2. æŸ¥çœ‹ä»£å‘æ¶ˆæ¯è®°å½•
curl -H "token: $TOKEN" \
  "http://localhost:8090/v1/manager/message?page=1&page_size=10"

# 3. æŸ¥çœ‹ç¾¤ç»„æ¶ˆæ¯
curl -H "token: $TOKEN" \
  "http://localhost:8090/v1/manager/message/record?channel_id=group123&page=1&page_size=20"

# 4. æŸ¥çœ‹ç”¨æˆ·ç§èŠè®°å½•
curl -H "token: $TOKEN" \
  "http://localhost:8090/v1/manager/message/recordpersonal?uid=user1&touid=user2&page=1&page_size=20"

# 5. å‘é€ç³»ç»Ÿæ¶ˆæ¯
curl -X POST -H "token: $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"content":"ç³»ç»Ÿç»´æŠ¤é€šçŸ¥"}' \
  "http://localhost:8090/v1/manager/message/sendall"
```

## ğŸ“Š æ•°æ®å­—æ®µè¯´æ˜

### æ¶ˆæ¯è®°å½•å­—æ®µ
- `message_id`: æ¶ˆæ¯å”¯ä¸€ID
- `message_seq`: æ¶ˆæ¯åºå·
- `sender`: å‘é€è€…UID
- `sender_name`: å‘é€è€…åç§°
- `payload`: æ¶ˆæ¯å†…å®¹ï¼ˆJSONæ ¼å¼ï¼‰
- `is_deleted`: æ˜¯å¦å·²åˆ é™¤ï¼ˆ0: å¦, 1: æ˜¯ï¼‰
- `readed_count`: å·²è¯»äººæ•°
- `revoke`: æ˜¯å¦æ’¤å›ï¼ˆ0: å¦, 1: æ˜¯ï¼‰
- `device_id`: è®¾å¤‡ID
- `device_name`: è®¾å¤‡åç§°
- `device_model`: è®¾å¤‡å‹å·
- `created_at`: å‘é€æ—¶é—´

### æ¶ˆæ¯ç±»å‹
- `type: 1`: æ–‡æœ¬æ¶ˆæ¯
- `type: 2`: å›¾ç‰‡æ¶ˆæ¯
- `type: 3`: è¯­éŸ³æ¶ˆæ¯
- `type: 4`: è§†é¢‘æ¶ˆæ¯
- `type: 5`: æ–‡ä»¶æ¶ˆæ¯

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**
   - æ‰€æœ‰æ¥å£éƒ½éœ€è¦ç®¡ç†å‘˜Token
   - éƒ¨åˆ†æ¥å£éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™

2. **åˆ†é¡µæŸ¥è¯¢**
   - æ‰€æœ‰åˆ—è¡¨æ¥å£éƒ½æ”¯æŒåˆ†é¡µ
   - å»ºè®®page_sizeä¸è¶…è¿‡100

3. **éšç§ä¿æŠ¤**
   - è¿™äº›æ¥å£ä»…ä¾›ç³»ç»Ÿç®¡ç†ä½¿ç”¨
   - è¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„

4. **æ€§èƒ½è€ƒè™‘**
   - å¤§é‡æ•°æ®æŸ¥è¯¢æ—¶å»ºè®®ä½¿ç”¨åˆ†é¡µ
   - é¿å…é¢‘ç¹è°ƒç”¨æ¥å£

## ğŸ”— ç›¸å…³æ¥å£

- **ç”¨æˆ·ç®¡ç†**: `/v1/manager/user/*`
- **ç¾¤ç»„ç®¡ç†**: `/v1/manager/group/*`
- **è®¾å¤‡ç®¡ç†**: `/v1/manager/user/devices`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜æˆ–æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ã€‚
